<html>
	<head>
    	<link rel="stylesheet" href="style.css" media="all" />
    	<script type="text/javascript" src="navigation.js"></script>
        <script type="text/javascript" src="challenges.js"></script>
		<script language="Javascript">

        //Settings Variables
        var CLICK = "clickMode";
        var ONESWITCH = "oneSwitch";
        var TWOSWITCH = "twoSwitch";
        var currentMode = CLICK;

        var timeIntreval = 400;
        var challengeMode = false;

        //Navigation Variables
		var currentLevel = 0;
		var highlightedItem = 0;
		var currentParent = navigation;
		var settings = navigation.children[8];
		var timer = settings.children[0];

        //Challenge Variables
        var isFirstChallenge = true;
        var challengeComplete = false;
        var promptOpen = false;
        var currentClothes = {};
        var challengeIterator = 0;
        var numberOfChallenges = challenges.children.length;
        var currentChallenge = challenges.children[challengeIterator];
        var challengeGoodFeedback = currentChallenge.positiveFeedback;
        var challengeBadFeedback = currentChallenge.negativeFeedback;

        function clearScreen(){ //Resets grid to a clean slate
            for (var j = 0; j < 10; j++) { 
                var label = "item" + j;
                document.getElementById(label).innerHTML = "";
                document.getElementById(label).className = "unSelected";
            }
            if(currentMode != CLICK){
                highlightedItem = 0;
                document.getElementById("item0").className = "selected";
                document.getElementById("actionText").innerHTML = currentParent.children[0].actionName;
            }
        }

		function loadScreen() {
			clearScreen();

            var actionBarVisibility = (currentMode == CLICK) ? "hidden" : "visible";
            document.getElementById("actionBar").style.visibility=actionBarVisibility;

			//Fill in grid with appropriate items
			for (var j = 0; j < currentParent.children.length; j++) { 
				var label = "item" + j;
			    document.getElementById(label).innerHTML = "<img src='images/" + currentParent.children[j].iconFile + "' height='80px'><br/ >" + currentParent.children[j].imageCaption;
			}
			
			//Add back button
			if(currentLevel > 0){
				label = "item" + currentParent.children.length;
				document.getElementById(label).innerHTML = "<img src='images/home.jpg'><br/ >Back";
			}
			
            if(challengeMode == true){
                //display 10th button
                var tenthButtonText = (challengeComplete ? "Next Challenge" : currentChallenge["challengePrompt"]);
                document.getElementById("item9").innerHTML = tenthButtonText;
                document.getElementById("item9").style.visibility="visible";
                
                if(isFirstChallenge){
                    showPrompt(currentChallenge.challengePrompt);
                    isFirstChallenge = false;
                }
            }
		}

        function showThought(text) {
            document.getElementById("thoughts").innerHTML = text;
            document.getElementById("thoughts").style.visibility="visible";
            window.setTimeout(function(){hideDiv("thoughts")},1000)
        }

        function showCongrats(text) {
            document.getElementById("congrats").innerHTML = text;
            document.getElementById("congrats").style.visibility="visible";
            window.setTimeout(function(){hideDiv("congrats")},800)
        }

        function hideDiv(parameter) {
            document.getElementById(parameter).style.visibility="hidden";
            if(parameter == "settings"){
                loadScreen();
            }else if(parameter == "prompt"){
                promptOpen = false;
                loadScreen();
            }
        }

        function showPrompt(text) {
            promptOpen = true;
            for (var j = 0; j < 10; j++) { 
                var label = "item" + j;
                document.getElementById(label).className = "unSelected";
            }
            if(currentMode != CLICK){
                document.getElementById("promptButton").className = "selected";
            }
            document.getElementById("promptText").innerHTML = text;
            document.getElementById("prompt").style.visibility="visible";
        }

        window.setInterval(function(){
            if(currentMode == ONESWITCH && promptOpen == false){
                iterate();
            }
        }, timeIntreval);

		function iterate(){
		
			//unselect previous
			document.getElementById("item" + highlightedItem).className = "unSelected";

			//increment which item we're currently selecting
			highlightedItem = highlightedItem+1;
			maxLength = currentParent.children.length;
			
			if(currentLevel > 0){  //add one for back button if not homescreen
				maxLength = maxLength +1;  
			}else {
                if(challengeComplete==true){maxLength++;}
            }
			
			//end of loop, begin at zero
			if(highlightedItem == maxLength){
				highlightedItem = 0;
			}
			
			//add action name
			if(currentLevel > 0 && highlightedItem == currentParent.children.length){
				document.getElementById("actionText").innerHTML = "Go back";
			}else if(currentLevel == 0 && highlightedItem == 9){
                document.getElementById("actionText").innerHTML = "Next Challenge";
            } else{
				document.getElementById("actionText").innerHTML = currentParent.children[highlightedItem].actionName;
			}
			
			//highlight current selection 
			document.getElementById("item" + highlightedItem).className = "selected";

		}
		
		window.addEventListener("keydown", dealWithKeyboard, false);

        function proceedToNextChallenge() {
            challengeIterator = challengeIterator + 1;
            if(numberOfChallenges <= challengeIterator){
                showPrompt("All challenges completed! Refresh page to play again.");
            }
            currentChallenge = challenges.children[challengeIterator];
            challengeGoodFeedback = currentChallenge.positiveFeedback;
            challengeBadFeedback = currentChallenge.negativeFeedback;
            challengeComplete = false;
        
        }

        function dealWithKeyboard(e){
            //alert(e.keyCode);
            if(currentMode != CLICK){
                if(promptOpen == true){
                    hideDiv('prompt');
                }else {
                    if(e.keyCode==13 || currentMode == ONESWITCH){
                        selectionMade(highlightedItem);
                    }else {
                        iterate();
                    }
                }
            }
        }

        function itemClick(i){
            if(currentMode == CLICK){
                if(i == "prompt"){
                    hideDiv("prompt");
                }else {
                    selectionMade(i);
                }
            }
        }

        function itemHover(i){
            if(currentMode == CLICK){
                if(i == "prompt"){
                    document.getElementById("promptButton").className = "selected";
                }else if(i == 9){
                    if(challengeComplete == true){
                        document.getElementById("item9").className = "selected";
                    }
                }else {
                    var label = "item" + i;
                    document.getElementById(label).className = "selected";
                }
            }
        }
        function itemHoverOff(i){
            if(currentMode == CLICK){
                if(i == "prompt"){
                    document.getElementById("promptButton").className = "unSelected";
                }else {
                    var label = "item" + i;
                    document.getElementById(label).className = "unSelected";
                }
            }
        }

		function selectionMade(selectedItem) {
            if(selectedItem == 9){ //Next Challenge
                if(challengeComplete == true){
                    proceedToNextChallenge();
                    loadScreen();
                    showPrompt(currentChallenge.challengePrompt);
                }
            }
			else if(currentLevel == 0){ //Go into sub category
				currentLevel = 1;
				currentParent = navigation.children[selectedItem];
				loadScreen();
			}else if (currentLevel == 1) {
				if(selectedItem == currentParent.children.length){ //going back a level
					currentLevel = 0;
					currentParent = navigation;
					loadScreen();
				}else if(currentParent == settings){ //going forward a level within settings
					currentLevel = 2;
					currentParent = settings.children[selectedItem];
					loadScreen();
				}else{  //add clothing item to screen
					url = "images/"+ currentParent.children[selectedItem].filename;
					document.getElementById(currentParent.divId).src=url;
                    currentClothes[currentParent.divId] = selectedItem;

                    if(challengeMode==true & challengeComplete==false){
                        giveChallengeFeedback(selectedItem);
                    }
				}
			}else { //NOTE: level 2 currently implies settings is parent
				if(highlightedItem == currentParent.children.length){ //going back a level
					currentLevel = 1;
					currentParent = settings;
					loadScreen();
				}else {
					//do seomthing to change settings
					if(currentParent == timer){
						timeIntreval = timer.children[selectedItem].time;
						
					}
				}
			}
		}	

        function giveChallengeFeedback(selectedItem){
            if (typeof currentChallenge.children[currentParent.divId] != 'undefined') {

                var message = challengeBadFeedback;
                var acceptableItems = currentChallenge.children[currentParent.divId];
                var isAcceptable = (acceptableItems.indexOf(selectedItem) > -1);

                if(isAcceptable){
                    message = challengeGoodFeedback;
                }
                showThought(message);

            }

            if(challengeIsComplete()){
                challengeComplete = true;
                currentLevel = 0;
                currentParent = navigation;
                loadScreen();
                showCongrats("Yeah you got it!");
                document.getElementById("item9").innerHTML = "Next Challenge";
            }
        }

        function challengeIsComplete(){
            var complete = true;
            var output = '', // initialise as string
                val;

            //If any of the required items is not current worn, it cannot be complete
            for (val in currentChallenge.children) {
                if (currentChallenge.children.hasOwnProperty(val)) {
                    output += "" + val + " : " + currentChallenge.children[val];
                    var acceptableItems = currentChallenge.children[val];
                    var isAcceptable = (acceptableItems.indexOf(currentClothes[val]) > -1);
                    if(!isAcceptable){
                        complete = false;
                    }
                    output += isAcceptable + "\n";
                }
            }
            return complete;
        }
		
        function changeInteractionMode(parameter){
            document.getElementById("interaction0").className = "unSelected";
            document.getElementById("interaction1").className = "unSelected";
            document.getElementById("interaction2").className = "unSelected";

            if(parameter == "twoswitch" ){
                currentMode = TWOSWITCH;
                document.getElementById("interaction2").className = "selected";
            }else if(parameter == "oneswitch" ){
                currentMode = ONESWITCH;
                document.getElementById("interaction1").className = "selected";
            }else if(parameter = "click"){
                currentMode = CLICK;
                document.getElementById("interaction0").className = "selected";
            }
        }
        function changePlayMode(parameter){
            document.getElementById("gameMode0").className = "unSelected";
            document.getElementById("gameMode1").className = "unSelected";

            if(parameter == "freeplay" ){
                challengeMode = false;
                document.getElementById("gameMode0").className = "selected";
            }else if(parameter == "challenge" ){
                challengeMode = true;
                document.getElementById("gameMode1").className = "selected";
            }
        }

		</script>
	</head>
	<body onload="loadScreen()">
		<div id="wrapper">
            <div id ="settings">
                <h1>Dress to the Max</h1><br />

                <h2>Settings</h2><br />

                <h3>Interaction Style</h3>
                <button class="selected" id="interaction0" onclick="changeInteractionMode('click')">Click</button>
                <button onclick="changeInteractionMode('oneswitch')" id="interaction1" >One Switch</button>
                <button onclick="changeInteractionMode('twoswitch')"id="interaction2" >Two Switch</button><br /><br />
                <h3>Challenge vs Freeplay</h3>
                <button class="selected" onclick="changePlayMode('freeplay')" id="gameMode0">Freeplay</button>
                <button onclick="changePlayMode('challenge')" id="gameMode1" >Challenge</button><br /><br />
                <h3>Play Game</h3>
                <button onclick="hideDiv('settings')">Done</button>
            </div>
			<h1>Dress to the Max</h1>
            <div id ="prompt">
                <span id="promptText"></span>
                <ul>
                    <li id="promptButton" onclick="itemClick('prompt')" onmouseover="itemHover('prompt')" onmouseout="itemHoverOff('prompt')">OK
                    </li>
                </ul>
            </div>
            <div id ="congrats">
                Yeah, you got it!
            </div>
            <div id="leftSide">
               <div id ="thoughts">
                </div>
    			<div id="character">
                    <img id="body" src="images/body/body-1.png">
    				<img id="hat" >
    				<img id="accessories" >
    				<img id="shirt" >
    				<img id="jacket"  >
    				<img id="pants"  >
    				<img id="shoes" >
    				<img id="backgrounds" >
    				<img id="hair"  >
    			</div>
            </div>
			<div id="navigation">
                <div id="actionBar">
				    Action: <span id ="actionText">asdf</span>
                </div>
				<ul onkeydown="keypress1(event);" id="navlist">
					<li id="item0" onclick="itemClick(0)" onmouseover="itemHover(0)" onmouseout="itemHoverOff(0)"></li>
                    <li id="item1" onclick="itemClick(1)" onmouseover="itemHover(1)" onmouseout="itemHoverOff(1)"></li>
                    <li id="item2" onclick="itemClick(2)" onmouseover="itemHover(2)" onmouseout="itemHoverOff(2)"></li>
                    <li id="item3" onclick="itemClick(3)" onmouseover="itemHover(3)" onmouseout="itemHoverOff(3)"></li>
                    <li id="item4" onclick="itemClick(4)" onmouseover="itemHover(4)"  onmouseout="itemHoverOff(4)"></li>
                    <li id="item5" onclick="itemClick(5)" onmouseover="itemHover(5)"  onmouseout="itemHoverOff(5)"></li>
                    <li id="item6" onclick="itemClick(6)" onmouseover="itemHover(6)"  onmouseout="itemHoverOff(6)"></li>
                    <li id="item7" onclick="itemClick(7)" onmouseover="itemHover(7)"  onmouseout="itemHoverOff(7)"></li>
                    <li id="item8" onclick="itemClick(8)" onmouseover="itemHover(8)"  onmouseout="itemHoverOff(8)"></li>
                    <li id="item9" onclick="itemClick(9)" onmouseover="itemHover(9)"  onmouseout="itemHoverOff(9)"></li>
				</ul>
			</div>
		</div>
		<p class="footer">
		UNC Chapel Hill, Maegan Clawges, Krista Katzenmeyer, Jon Medenblik.  <a href="https://github.com/kkatzen/dress-to-the-max">Github</a>
		</p>
	</body>
</html>