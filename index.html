<html>
	<head>
    	<link rel="stylesheet" href="style.css" media="all" />
    	<script type="text/javascript" src="navigation.json"></script>
		<script language="Javascript">

var navigation = {
    "derp":"derp",
    "children":
    [
        {
            "filename":"shirt",
            "imageCaption":"Shirt",
            "actionName":"View Shirts",
            "children":
            [
                {
                    "filename":"shirt/shirt",
                    "imageCaption":"Fireman Shirt",
                    "actionName":"Wear Fireman Shirt"
                },
                {
                    "filename":"shirt/labcoat",
                    "imageCaption":"Lab Coat",
                    "actionName":"Wear Lab Coat"
                },
                {
                    "filename":"shirt/shirt3",
                    "imageCaption":"Jersey",
                    "actionName":"Wear Jersey"
             	},
                {
                    "filename":"shirt/shirt4",
                    "imageCaption":"Raincoat",
                    "actionName":"Wear Raincoat"
                },
                {
                    "filename":"shirt/shirt4",
                    "imageCaption":"Sweater",
                    "actionName":"Wear Sweater"
                },
                {
                    "filename":"shirt/shirt4",
                    "imageCaption":"Tee Shirt",
                    "actionName":"Wear Tee Shirt"
                },
                {
                    "filename":"shirt/shirt4",
                    "imageCaption":"Pajamas",
                    "actionName":"Wear Pajamas"
                },
                {
                    "filename":"shirt/shirt4",
                    "imageCaption":"Hoodie",
                    "actionName":"Wear Hoodie"
                }

            ]
        },
        {
            "filename":"pants",
            "imageCaption":"Pants",
            "actionName":"View Pants",
            "children":
            [
            
                {
                    "filename":"pants/pants",
                    "imageCaption":"Jeans",
                    "actionName":"Wear Jeans"
                },
                {
                    "filename":"pants/pants2",
                    "imageCaption":"Shorts",
                    "actionName":"Wear Shorts"
                },
                {
                    "filename":"pants/pants3",
                    "imageCaption":"Yoga Pants",
                    "actionName":"Wear Yoga Pants"
                },
                {
                    "filename":"pants/scrubs",
                    "imageCaption":"Scrubs",
                    "actionName":"Wear Scrubs"
                },
                {
                    "filename":"pants/pants4",
                    "imageCaption":"Skirt",
                    "actionName":"Wear Skirt"
                },
                {
                    "filename":"pants/pants4",
                    "imageCaption":"Pajamas",
                    "actionName":"Wear Pajamas"
                },
                {
                    "filename":"pants/pants4",
                    "imageCaption":"Fireman Pants",
                    "actionName":"Wear Fireman Pants"
                },
                {
                    "filename":"pants/pants4",
                    "imageCaption":"Kilt",
                    "actionName":"Wear Kilt"
                }            
            ]
        },
        {
            "filename":"shoes",
            "imageCaption":"Shoes",
            "actionName":"View Shoes",
            "children":
            [
            
                {
                    "filename":"shoes/shoes",
                    "imageCaption":"shoes",
                    "actionName":"Wear shoes"
                }
			]
        },
        {
            "filename":"jacket",
            "imageCaption":"Jackets",
            "actionName":"View Jackets",
            "children":
            [
            
                {
                    "filename":"jacket/jacket",
                    "imageCaption":"jacket",
                    "actionName":"Wear jacket"
                }
			]
        },
        {
            "filename":"hat",
            "imageCaption":"Hats",
            "actionName":"View Hats",
            "children":
            [
            
                {
                    "filename":"hat/hat",
                    "imageCaption":"Sun Hat",
                    "actionName":"Wear Sun Hat"
                },
                {
                    "filename":"hat/hat2",
                    "imageCaption":"Red Hat",
                    "actionName":"Wear Red Hat"
                }
			]
        },
        {
            "filename":"accessories",
            "imageCaption":"Accessories",
            "actionName":"View Accessories",
            "children":
            [
            
                {
                    "filename":"accessories/accessories",
                    "imageCaption":"Scarf",
                    "actionName":"Wear Scarf"
                },
                {
                    "filename":"face/face",
                    "imageCaption":"face",
                    "actionName":"Wear Face"
                }
			]

        },
        {
            "filename":"backgrounds",
            "imageCaption":"Backgrounds",
            "actionName":"View Backgrounds",
            "children":
            [
            
                {
                    "filename":"backgrounds/backgrounds",
                    "imageCaption":"backgrounds",
                    "actionName":"Wear backgrounds"
                }
			]
        },
        {
            "filename":"face",
            "imageCaption":"Character",
            "actionName":"View Character Options",
            "children":
            [
            
                {
                    "filename":"face/face",
                    "imageCaption":"face",
                    "actionName":"Wear face"
                }
			]
        },
        {
            "filename":"settings",
            "imageCaption":"Settings",
            "actionName":"Change Settings",
            "children":
            [
            
                {
                    "filename":"settings/clock",
                    "imageCaption":"Timer",
                    "actionName":"Change Timer",
                    "children":
                    [
                    	{
                    		"time":700,
                 		   "filename":"settings/clock",
                 		   "imageCaption":"small",
                 		   "actionName":"S"
                    	},
                    	{
                    		"time":1000,
                 		   "filename":"settings/clock",
                 		   "imageCaption":"medium",
                 		   "actionName":"M"
                    	},
                    	{
                    		"time":1500,
                 		   "filename":"settings/clock",
                 		   "imageCaption":"long",
                 		   "actionName":"long"
                    	}
                    ]
                },
                {
                    "filename":"settings/puzzle",
                    "imageCaption":"Game Mode",
                    "actionName":"Change game Mode",
                    "children":
                    [
                    	{
                 		   "filename":"settings/puzzle",
                 		   "imageCaption":"Freeplay",
                 		   "actionName":"Use Freeplay Mode"
                    	},
                    	{
                    		"time":1000,
                 		   "filename":"settings/puzzle",
                 		   "imageCaption":"Challenge",
                 		   "actionName":"Use Challenge Mode"
                    	}
                    	
                    ]
                }
            ]
        }
    ]
}

var challenges = {
    "derp":"derp",
    "children":
    [
        {
            "challengePrompt":"Dress Max like a Doctor",
            "positiveFeedback":"Perfect!",
            "negativeFeedback":"Is this what a Doctor would wear?",
            "children":
                {
                    "shirt":[1,4],
                    "pants":[3]
                }
        },
        {
            "challengePrompt":"Dress Max like a Fireman",
            "positiveFeedback":"Get at me fires!",
            "negativeFeedback":"Is this what a Fireman would wear?",
            "children":
                {
                    "hat":[1]
                }
        },
        {
            "challengePrompt":"Wear a scarf! its cold yo",
            "positiveFeedback":"Yay so warm now!",
            "negativeFeedback":"Hurry I'm freezing to death!!!",
            "children":
                {
                    "accessories":[0]
                }
        }

    ]
}
        //Settings Variables
        var clickMode = false;  //dominate: if true, twoswitch boolean essentially false
        var twoSwitch = true;
        var timeIntreval = 400;
        var challengeMode = true;

        //Navigation Variables
		var currentLevel = 0;
		var highlightedItem = 0;
		var currentParent = navigation;
		var settings = navigation.children[8];
		var timer = settings.children[0];

        //Challenge Variables
        var challengeComplete = false;
        var currentClothes = {};
        var challengeIterator = 0;
        var numberOfChallenges = challenges.children.length;
        var currentChallenge = challenges.children[challengeIterator];
        var challengeGoodFeedback = currentChallenge.positiveFeedback;
        var challengeBadFeedback = currentChallenge.negativeFeedback;

		function loadScreen() {
			clearScreen();
            if(clickMode == true){
                document.getElementById("actionBar").style.visibility="hidden";
            }
		
            if(challengeMode == true){
                document.getElementById("item9").style.visibility="visible";
                if(challengeComplete == false){
                    document.getElementById("item9").innerHTML = currentChallenge["challengePrompt"];
                }else{
                    document.getElementById("item9").innerHTML = "Next Challenge";
                }
            }

			//Fill in grid with appropriate items
			for (var j = 0; j < currentParent.children.length; j++) { 
				var label = "item" + j;
			    document.getElementById(label).innerHTML = "<img src='images/" + currentParent.children[j].filename + ".jpg' height='80px'><br/ >" + currentParent.children[j].imageCaption;
			}
			
			//Add back button
			if(currentLevel > 0){
				label = "item" + currentParent.children.length;
				document.getElementById(label).innerHTML = "<img src='images/home.jpg'><br/ >Back";
			}
			
		}

        function showThought(text) {
            document.getElementById("thoughts").innerHTML = text;
            document.getElementById("thoughts").style.visibility="visible";
            window.setTimeout(hideThought,1000)
        }
        function hideThought() {
            document.getElementById("thoughts").style.visibility="hidden";
        }

        window.setInterval(function(){
            if(twoSwitch == false && clickMode == false){
                iterate();
            }
        }, timeIntreval);

		function iterate(){
		
			//unselect previous
			document.getElementById("item" + highlightedItem).className = "unSelected";

			//increment which item we're currently selecting
			highlightedItem = highlightedItem+1;
			maxLength = currentParent.children.length;
			
			if(currentLevel > 0){  //add one for back button if not homescreen
				maxLength = maxLength +1;  
			}else {
                if(challengeComplete==true){maxLength++;}
            }
			
			//end of loop, begin at zero
			if(highlightedItem == maxLength){
				highlightedItem = 0;
			}
			
			//add action name
			if(currentLevel > 0 && highlightedItem == currentParent.children.length){
				document.getElementById("actionText").innerHTML = "Go back";
			}else if(currentLevel == 0 && highlightedItem == 9){
                document.getElementById("actionText").innerHTML = "Next Challenge";
            } else{
				document.getElementById("actionText").innerHTML = currentParent.children[highlightedItem].actionName;
			}
			
			//highlight current selection 
			document.getElementById("item" + highlightedItem).className = "selected";


		}
		
		window.addEventListener("keydown", dealWithKeyboard, false);

        function proceedToNextChallenge() {
            challengeIterator = challengeIterator + 1;
            if(numberOfChallenges <= challengeIterator){
                alert("All challenges completed! Refresh page to play again.");
            }
            currentChallenge = challenges.children[challengeIterator];
            challengeGoodFeedback = currentChallenge.positiveFeedback;
            challengeBadFeedback = currentChallenge.negativeFeedback;
            challengeComplete = false;
        }

        function dealWithKeyboard(e){
            //alert(e.keyCode);
            if(clickMode == false){
                if(e.keyCode==13){
                    selectionMade(highlightedItem);
                }else {
                    iterate();
                }

            }
        }

        function itemClick(i){
            if(clickMode == true){
                selectionMade(i);
            }
        }

		function selectionMade(selectedItem) {
            if(selectedItem == 9){ //Next Challenge
                proceedToNextChallenge();
                loadScreen();
            }
			else if(currentLevel == 0){
				currentLevel = 1;
				currentParent = navigation.children[selectedItem];
				loadScreen();
			}else if (currentLevel == 1) {
				if(selectedItem == currentParent.children.length){ //going back a level
					currentLevel = 0;
					currentParent = navigation;
					loadScreen();
				}else if(currentParent == settings){ //going forward a level within settings
					currentLevel = 2;
					currentParent = settings.children[selectedItem];
					loadScreen();
				}else{  //add clothing item to screen
					url = "images/"+ currentParent.children[selectedItem].filename + ".jpg";
					document.getElementById(currentParent.filename).src=url;
                    currentClothes[currentParent.filename] = selectedItem;

                    if(challengeMode==true & challengeComplete==false){
                        giveChallengeFeedback(selectedItem);
                    }
				}
			}else { //NOTE: level 2 currently implies settings is parent
				if(highlightedItem == currentParent.children.length){ //going back a level
					currentLevel = 1;
					currentParent = settings;
					loadScreen();
				}else {
					//do seomthing to change settings
					if(currentParent == timer){
						timeIntreval = timer.children[selectedItem].time;
						
					}
				}
			}
		}	

        function giveChallengeFeedback(selectedItem){
            if (typeof currentChallenge.children[currentParent.filename] != 'undefined') {

                var message = challengeBadFeedback;
                var acceptableItems = currentChallenge.children[currentParent.filename];
                var isAcceptable = (acceptableItems.indexOf(selectedItem) > -1);

                if(isAcceptable){
                    message = challengeGoodFeedback;
                }
                showThought(message);

            }

            if(checkChallengeStatus() == true){
                challengeComplete = true;
                currentLevel = 0;
                currentParent = navigation;
                loadScreen();
                document.getElementById("item9").innerHTML = "Next Challenge";
            }
        }

        function checkChallengeStatus(){
            var complete = true;
            var index;
            var output = '', // initialise as string
                val;

            //If any of the required items is not current worn, it cannot be complete
            for (val in currentChallenge.children) {
                if (currentChallenge.children.hasOwnProperty(val)) {
                    output += "" + val + " : " + currentChallenge.children[val];
                    output += "\n";
                    var acceptableItems = currentChallenge.children[val];
                    var isAcceptable = (acceptableItems.indexOf(currentClothes[val]) > -1);
                    if(!isAcceptable){
                        complete = false;
                    }
                }
            }
            return complete;
        }
		
		function clearScreen(){ //Resets grid to a clean slate
			for (var j = 0; j < 10; j++) { 
				var label = "item" + j;
			    document.getElementById(label).innerHTML = "";
				document.getElementById(label).className = "unSelected";
			}
            if(clickMode == false){
    			highlightedItem = 0;
    			document.getElementById("item0").className = "selected";
    			document.getElementById("actionText").innerHTML = currentParent.children[0].actionName;
		    }
        }
		
		</script>
	</head>
	<body onload="loadScreen()">
		<div id="wrapper">
			<h1>Dress to the Max</h1>
            <div id="leftSide">
                <div id ="thoughts">
                </div>
    			<div id="character">
    				<img id="hat" >
    				<img id="accessories" >
    				<img id="shirt" >
    				<img id="jacket"  >
    				<img id="pants"  >
    				<img id="shoes" >
    				<img id="backgrounds" >
    				<img id="face"  >
    			</div>
            </div>
			<div id="navigation">
                <div id ="challenge">
                </div>
                <div id="actionBar">
				    Action: <span id ="actionText"></span>
                </div>
				<ul onkeydown="keypress1(event);" id="navlist">
					<li id="item0" onclick="itemClick(0)"></li>
                    <li id="item1" onclick="itemClick(1)"></li>
                    <li id="item2" onclick="itemClick(2)"></li>
                    <li id="item3" onclick="itemClick(3)"></li>
                    <li id="item4" onclick="itemClick(4)"></li>
                    <li id="item5" onclick="itemClick(5)"></li>
                    <li id="item6" onclick="itemClick(6)"></li>
                    <li id="item7" onclick="itemClick(7)"></li>
                    <li id="item8" onclick="itemClick(8)"></li>
                    <li id="item9" onclick="itemClick(9)"></li>
				</ul>
			</div>
		</div>
		<p class="footer">
		UNC Chapel Hill, Maegan Clawges, Krista Katzenmeyer, Jon Medenblik.  <a href="https://github.com/kkatzen/dress-to-the-max">Github</a>
		</p>
	</body>
</html>